# TRE CLI - Proof Of Concept

This is a minimal POC of a CLI client for TRE. It is written in Python and uses autogenerated API client which has been created from the published OpenAPI spec (aka Swagger). 

The generator used was:
[OpenAPI tools generator](https://github.com/OpenAPITools/openapi-generator)

# Setup

## Install packages

Currently this has been done as a separate virtual env, until a better way to build/bundle the CLI can be found
 
```bash
cd cli
python3 -m venv ./.venv
source ./.venv/bin/activate
pip install -r requirements.txt
```

## Config

Edit config.json file and set `endpoint`, `clientId` and `tenantId`

# Running & Usage

Currently only three commands are implemented `login`, `logout` and `workspace`. The `workspace` command has two verbs sub-commands `workspace show` and `workspace list`

```text
./tre

Usage: tre [OPTIONS] COMMAND [ARGS]...

Options:
  --debug / --no-debug
  --help                Show this message and exit.

Commands:
  login
  logout
  version
  workspace
```

# Update The OpenAPI Client SDK

To generate or update the TRE API client code, use the openapi-generator-cli Docker container, as follows:

```bash
cd cli
swagger="https://ocwtre32.northeurope.cloudapp.azure.com/api/openapi.json"
docker run --rm -v "${PWD}:/local" openapitools/openapi-generator-cli generate \
    -i $swagger \
    -g python \
    -o /local/client
```

The client code needs to be moved up one level, otherwise the imports don't work

```bash
mv client/openapi_client ./openapi_client
```

The output will be owned by root, so change the username & group to your own before committing into git

```bash
sudo chown -R youruser:youruser openapi_client
```